import{_ as g}from"./geoplace_icon-DxfKkP6l.js";import{E as p}from"./email-By2tpRiR.js";import{A as u,N as c}from"./notify_popup-DbA6jAa4.js";import{r as l,b as v,c as f,d as _,e as w,a,f as k,u as h,o as r}from"./index-BrPbIO-S.js";import{_ as b}from"./_plugin-vue_export-helper-DlAUqK2U.js";const y={id:"getNLink-page"},N={__name:"getNewLink",setup(T){const n=l(null),d=h(),e=l({show_loading:!0,goto:void 0,button_text:"Ok, tudo certo",message:"Opa, tudo joia meu parça",icon:"warning.png"}),s=l(!1);v(async()=>{let t=window.localStorage.getItem("gpl_lgToken");if(t!=null){console.log("há um token de sessão, tentando validar");const o={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({user_token:t||""})};try{if((await fetch(u.API_URL+"/check-token",o)).status==200)return d.push("/home");window.login_token.removeItem("gpl_lgToken");return}catch{return}}});const m=async()=>{if(n.value.status){s.value=!0,e.value.show_loading=!0;try{const t={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({user_email:n.value.addres})},o=await fetch(u.API_URL+"/get-new-scode",t);o.status==401&&(setTimeout(()=>{e.value.show_loading=!1},200),e.value.message="Essa conta já foi ativada, você já pode efetuar login..",e.value.goto="/login",e.value.button_text="login",window.localStorage.removeItem("gpl_isPendg")),(o.status==404||o.status==400)&&(setTimeout(()=>{e.value.show_loading=!1},200),e.value.message="Não há nenhuma conta cadastrada com esse endereço de email",e.value.goto=void 0,e.value.button_text="fechar"),o.status==429&&(setTimeout(()=>{e.value.show_loading=!1},200),e.value.message="Você não pode mais solicitar códigos de ativação, tente novamente em 30 minutos",e.value.goto=void 0,e.value.button_text="fechar"),o.status==200&&(setTimeout(()=>{e.value.show_loading=!1},200),e.value.message="Tudo certo, enviamos um novo link para o seu endereço de email",e.value.goto=void 0,e.value.button_text="fechar",window.localStorage.setItem("gpl_isPendg","ok"))}catch{setTimeout(()=>{e.value.show_loading=!1},200),e.value.message="Ué, Nosso servidor não está respondendo, por favor volte outra hora!!",e.value.goto=void 0,e.value.button_text="fechar"}}};return(t,o)=>(r(),f("div",y,[s.value?(r(),_(c,{key:0,attributes:e.value,onClosePopup:o[0]||(o[0]=()=>{s.value=!s.value})},null,8,["attributes"])):w("",!0),a("main",null,[o[2]||(o[2]=a("img",{src:g,alt:"geoplace image logo"},null,-1)),o[3]||(o[3]=a("h1",null,"Não recebeu o email de ativação?",-1)),o[4]||(o[4]=a("p",{id:"desc"}," Então informe o endereço de email utilizado no momento do cadastro, para que possamos enviar um novo link de ativação.. ",-1)),k(p,{ref_key:"email_ref",ref:n},null,512),a("button",{onClick:o[1]||(o[1]=i=>m())},"Enviar Código")])]))}},O=b(N,[["__scopeId","data-v-7a9477d0"]]);export{O as default};
